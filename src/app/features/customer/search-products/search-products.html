<div class="page-container">
  <aside class="sidebar" dir="rtl">
    <!-- Header -->
    <div class="filter-header">
      <span>فلاتر البحث</span>
      <button class="clear-all" (click)="clearAll()">مسح الكل</button>
    </div>

    <!-- Keyword -->
    <div class="filter-section mb-3">
      <span class="p-input-icon-right w-full">
        <i class="pi pi-search"></i>
        <input
          type="text"
          pInputText
          [(ngModel)]="filters.Keyword"
          placeholder="بحث بالاسم..."
          class="w-full"
        />
      </span>
    </div>

    <!-- Price -->
    <div class="filter-section">
      <label class="font-bold">نطاق السعر (ريال)</label>
      <div class="price-inputs">
        <input type="text" [value]="filters.MinPrice" readonly />
        <input type="text" [value]="filters.MaxPrice" readonly />
      </div>

      <p-slider
        [(ngModel)]="rangeValues"
        [range]="true"
        [min]="0"
        [max]="10000"
        (onChange)="onPriceChange()"
        class="price-slider"
      ></p-slider>
    </div>

    <!-- Vehicle Data -->
    <details class="filter-dropdown" open>
      <summary>بيانات المركبة <span class="chevron"></span></summary>
      <div class="dropdown-content">
        <!-- Vehicle Type -->
        <div class="field">
          <label class="text-xs">نوع المركبة</label>
          <p-select
            [options]="vehicleTypes"
            [(ngModel)]="filters.VehicleTypeId"
            optionLabel="nameAr"
            optionValue="id"
            placeholder="نوع المركبة"
            [showClear]="true"
            class="w-full"
            (onChange)="onVehicleTypeChange($event.value)"
          ></p-select>
        </div>

        <!-- Make -->
        <div class="field">
          <label class="text-xs">الماركة</label>
          <p-select
            [options]="makes"
            [(ngModel)]="filters.MakeId"
            optionLabel="nameAr"
            optionValue="id"
            placeholder="اختر الماركة"
            [filter]="true"
            filterBy="nameAr"
            [showClear]="true"
            class="w-full"
            (onChange)="onMakeChange($event.value)"
          ></p-select>
        </div>

        <!-- Model -->
        <div class="field">
          <label class="text-xs">الموديل</label>
          <p-select
            [options]="models"
            [(ngModel)]="filters.ModelId"
            optionLabel="nameAr"
            optionValue="id"
            placeholder="اختر الموديل"
            [filter]="true"
            filterBy="nameAr"
            [showClear]="true"
            class="w-full"
          ></p-select>
        </div>

        <!-- Year -->
        <div class="field">
          <label class="text-xs">السنة</label>
          <p-select
            [options]="years"
            [(ngModel)]="filters.Year"
            optionValue="year"
            optionLabel="year"
            placeholder="السنة"
            [showClear]="true"
            class="w-full"
          ></p-select>
        </div>
      </div>
    </details>

    <!-- Category & Condition -->
    <details class="filter-dropdown">
      <summary>التصنيف والحالة <span class="chevron"></span></summary>
      <div class="dropdown-content">
        <!-- Sub Category -->
        <div class="field">
          <label class="text-xs">القسم</label>
          <p-select
            [options]="subCategories"
            [(ngModel)]="filters.CategoryId"
            optionLabel="nameAr"
            optionValue="id"
            placeholder="اختر القسم"
            [showClear]="true"
            class="w-full"
          ></p-select>
        </div>

        <!-- Condition -->
        <div class="field mt-3">
          <label class="block mb-2 text-xs">حالة القطعة</label>
          <div class="flex flex-column gap-2">
            @for (cond of conditions; track cond.id) {
              <div class="flex align-items-center gap-2">
                <p-radioButton
                  name="condition"
                  [value]="cond.id"
                  [(ngModel)]="filters.ConditionId"
                  [inputId]="'cond-' + cond.id"
                ></p-radioButton>
                <label class="cursor-pointer" [for]="'cond-' + cond.id">
                  {{ cond.nameAr }}
                </label>
              </div>
            }
          </div>
        </div>
      </div>
    </details>

    <!-- Location -->
    <details class="filter-dropdown">
      <summary>الموقع <span class="chevron"></span></summary>
      <div class="dropdown-content">
        <p-select
          [options]="cities"
          [(ngModel)]="filters.CityId"
          optionLabel="nameAr"
          optionValue="id"
          placeholder="اختر المدينة"
          [filter]="true"
          filterBy="nameAr"
          [showClear]="true"
          class="w-full"
        ></p-select>
      </div>
    </details>

    <!-- Extra Options -->
    <details class="filter-dropdown">
      <summary>خيارات إضافية <span class="chevron"></span></summary>
      <div class="dropdown-content">
        <div class="flex flex-column gap-3">
          <div>
            <label class="text-xs block mb-1">الضمان</label>
            <p-selectButton
              [options]="boolOptions"
              [(ngModel)]="filters.HasWarranty"
              optionLabel="label"
              optionValue="value"
            ></p-selectButton>
          </div>

          <div>
            <label class="text-xs block mb-1">التوصيل</label>
            <p-selectButton
              [options]="boolOptions"
              [(ngModel)]="filters.DeliveryAvailable"
              optionLabel="label"
              optionValue="value"
            ></p-selectButton>
          </div>
        </div>
      </div>
    </details>

    <!-- Apply -->
    <button class="apply-btn" (click)="applyFilters()">تطبيق الفلاتر</button>
  </aside>

  <!-- Main -->
  <main class="main-content">
    <header class="results-header">
      <h2>{{ resultsHeader }}</h2>
      <p>{{ resultsSummary }}</p>
    </header>

    <!-- Products -->
    <div class="product-grid">
      @for (item of products; track $index) {
        <app-product-card [product]="item"></app-product-card>
      }
    </div>
    @if (products.length === 0) {
      <div class="no-products">
        <lucide-icon [img]="Annoyed" [size]="100"></lucide-icon>

        <h3>لا توجد قطع مطابقة للبحث</h3>
        <p>حاول تغيير الفلاتر أو البحث بكلمات مختلفة</p>
      </div>
    }

    <!-- Pagination -->
    <app-pagination
      [totalRecords]="pagination.totalItems"
      [rowsPerPage]="pagination.pageSize"
      (pageChange)="onPageChange($event)"
    ></app-pagination>
  </main>
</div>
