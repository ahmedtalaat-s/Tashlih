<div class="container">
  <!-- Chat -->
  <div class="chat-container">
    <div class="messages-area">
      @for (msg of messages; track msg.id) {
        <div class="msg" [class.sent]="isSent(msg)" [class.received]="!isSent(msg)">
          <!-- TEXT MESSAGE -->
          @if (msg.messageType === 'text' && msg.content) {
            <div class="msg-content">
              {{ msg.content }}
            </div>
          }

          <!-- VOICE MESSAGE -->
          @if (msg.messageType === 'voice' && msg.attachments.length > 0) {
            <div class="voice-msg">
              @for (attachment of msg.attachments; track attachment.fileUrl) {
                @if (attachment.fileType === 'voice') {
                  <audio controls class="voice-player">
                    <source [src]="attachment.fileUrl" type="audio/mpeg" />
                    متصفحك لا يدعم تشغيل الصوت
                  </audio>
                  @if (attachment.duration) {
                    <span class="duration">{{ attachment.duration }}ث</span>
                  }
                }
              }
            </div>
          }

          <!-- IMAGE MESSAGE -->
          @if (msg.messageType === 'image' || msg.messageType === 'mixed') {
            <div class="images-container">
              @for (attachment of msg.attachments; track attachment.fileUrl) {
                @if (attachment.fileType === 'image') {
                  <img [src]="attachment.fileUrl" alt="Chat image" class="chat-image" />
                }
              }
            </div>
          }

          <!-- VIDEO MESSAGE -->
          @if (msg.messageType === 'video' || msg.messageType === 'mixed') {
            <div class="videos-container">
              @for (attachment of msg.attachments; track attachment.fileUrl) {
                @if (attachment.fileType === 'video') {
                  <video controls class="chat-video">
                    <source [src]="attachment.fileUrl" type="video/mp4" />
                    متصفحك لا يدعم تشغيل الفيديوهات
                  </video>
                }
              }
            </div>
          }

          <!-- MESSAGE TIME -->
          <span class="msg-time">{{ formatDate(msg.createdAt) }}</span>
        </div>
      }
    </div>

    <!-- Input -->
    <div class="input-area">
      <div class="input-wrapper">
        <button class="btn-attach">
          <span>
            <lucide-icon [img]="imageIcon" [size]="21"></lucide-icon>
          </span>
        </button>
        <span class="splitter"></span>
        <lucide-icon [img]="pen" class="penIcon" [size]="17"></lucide-icon>
        <input type="text" [(ngModel)]="messageText" placeholder="اكتب رسالتك هنا..." />
      </div>
      <button class="btn-send" (click)="onSend()">
        <lucide-icon [img]="sendIcon"></lucide-icon>
      </button>
    </div>
  </div>
  <!-- Sidebar -->
  <div class="sidebar">
    <div>
      <div class="section-title">معلومات المورد</div>
      <div class="card">
        <div class="supplier-info">
          <div class="icon-placeholder">
            <lucide-icon [img]="imageIcon"></lucide-icon>
          </div>
          <div class="supplier-details">
            <h3>{{ supplierName }}</h3>
            <p>
              <lucide-icon [img]="phoneIcon" [size]="16"></lucide-icon>
              {{ supplierPhone }}
            </p>
          </div>
        </div>
        <p class="location">
          <lucide-icon [img]="mapIcon" [size]="16"></lucide-icon>
          {{ supplierLocation }}
        </p>
      </div>
    </div>

    @if (partName) {
      <div>
        <div class="section-title">معلومات القطعة</div>
        <div class="card order-info">
          <label>اسم القطعة</label>
          <input type="text" [value]="partName" readonly />

          @if (partPrice) {
            <div class="price-row">
              <div class="price-box">
                <label>سعر القطعة</label>
                <span class="input" [innerHTML]="+partPrice | saudiRiyal"></span>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <button class="btn-profile">الملف الشخصي</button>
  </div>
</div>
